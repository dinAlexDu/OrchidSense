<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de Temperaturas</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Inclua a biblioteca Chart.js -->
{#    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>#}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
{#    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>#}
{#    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>#}
{#    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>#}


</head>
<body>
    <!-- Área Principal -->
    <main class="content">
        <!-- Menu Vertical à Esquerda (Você pode copiar o menu do dashboard.html) -->
        <nav class="vertical-menu">
            <ul>
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/historico">Histórico de Temperaturas</a></li>
                <li><a href="/notificacoes">Notificações</a></li>
                <li><a href="/perfil">Perfil do Usuário</a></li>
                <li><a href="/logout">Logout</a></li>
                <li><a href="/labenv">Lab</a></li>
            </ul>
        </nav>

        <!-- Histórico de Temperaturas -->
        <div id="historico">
            <h1>Histórico de Temperaturas</h1>

            <!-- Formulário para filtrar por datas -->
            <form action="/historico" method="post">
                <label for="data_inicio">Data de Início:</label>
                <input type="date" id="data_inicio" name="data_inicio">

                <label for="data_fim">Data de Fim:</label>
                <input type="date" id="data_fim" name="data_fim">

                <input type="submit" value="Filtrar">
            </form>

            <!-- Seção para o gráfico -->
            <div class="chart-container">
                TESTE
                <canvas id="historico-chart" width="1000" height="600"></canvas>
            </div>



            <!-- Lista das últimas temperaturas e Humidade -->
            <div class="historico-dados">
                <h2>Últimas Temperaturas e Humidade</h2>
                <ul>
                    <!-- Aqui você pode usar um loop para exibir os dados históricos -->
                    {% for dado in dados %}
                        <li>Data: {{ dado.data }}, Temperatura: {{ dado.temperatura|round(2) }} °C, Humidade: {{ dado.humidade|round(2) }} %</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Defina uma variável JavaScript global com os dados do histórico
        var dados = {{ dados|tojson|safe }};
        console.log("Dados Recebidos:", dados); // Adicione isso para depurar

        // Obter uma referência ao elemento de gráfico de histórico
        var historicoChart = document.getElementById("historico-chart").getContext("2d");

        // Extrair as datas e temperaturas dos dados
        var datas = [];
        var temperaturas = [];

        {% for dado in dados %}
            var dataHora = new Date("{{ dado.data }}");
            console.log("Data Formatada", dataHora);
            datas.push(dataHora);
            temperaturas.push({{ dado.temperatura }});
        {% endfor %}

        console.log("Datas Formatadas:", datas);

        // Criar um gráfico de linha
        var chart = new Chart(historicoChart, {
            type: "line",
            data: {
                labels: datas, // Use as datas no eixo X
                datasets: [
                    {
                        label: "Temperatura (°C)",
                        data: temperaturas, // Use as temperaturas no eixo Y
                        borderColor: "blue",
                        backgroundColor: "rgba(0, 0, 255, 0.2)", // Cor de fundo
                        fill: false,
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        type: "time", // Especifica que as datas estão no eixo X
                        time: {
                            {#tooltipFormat: 'YYYY-MM-DD HH:mm:ss', // Formato da dica de ferramenta#}
                            {#unit: 'minute', // Usar unidades de segundos#}
                            displayFormats: {
                                datetime: 'yyyy-MM-DD HH:mm:ss', // Formato da data e hora
                            },
                        },
                    },
                },
            },
        });
    });
</script>



</body>
</html>
